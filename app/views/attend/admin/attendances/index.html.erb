<%= render 'nav_attendances' %>

<%= render 'filter_form' %>

<table class="table is-hoverable is-fullwidth">
  <thead>
    <tr>
      <th><%= Attendance.human_attribute_name(:id) %></th>
      <th><%= Attendance.human_attribute_name(:member) %></th>
      <th><%= Attendance.human_attribute_name(:attend_on) %></th>
      <th>
        <p><%= Attendance.human_attribute_name(:start_at) %></p>
        <p><%= Attendance.human_attribute_name(:finish_at) %></p>
      </th>
      <th>
        <p><%= Attendance.human_attribute_name(:interval_start_at) %></p>
        <p><%= Attendance.human_attribute_name(:interval_finish_at) %></p>
      </th>
      <th><%= Attendance.human_attribute_name(:interval_hours) %></th>
      <th>
        <p><%= Attendance.human_attribute_name(:late_minutes) %></p>
        <p><%= Attendance.human_attribute_name(:leave_minutes) %></p>
      </th>
      <th>
        <p><%= Attendance.human_attribute_name(:attend_hours) %></p>
        <p><%= Attendance.human_attribute_name(:overtime_hours) %></p>
      </th>
      <th><%= Attendance.human_attribute_name(:workday) %></th>
      <th><%= Attendance.human_attribute_name(:kind) %></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
  <% @attendances.each do |attendance| %>
    <tr>
      <td><%= attendance.id %></td>
      <td><%= attendance.member.name %></td>
      <td><%= attendance.attend_on %></td>
      <td>
        <p><time data-format="HH:mm"><%= attendance.start_at&.to_s(:rfc822) %></time></p>
        <p>
          <% if attendance.finish_at %>
            <time data-format="HH:mm"><%= attendance.finish_at.to_s(:rfc822) %></time>
          <% elsif attendance.finish_at.blank? && attendance.start_at.present? %>
            <%= link_to 'Re-Punch', new_admin_attendance_log_path(attendance_id: attendance.id), remote: true, class: 'ui teal mini button' %>
          <% end %>
        </p>
      </td>
      <td>
        <p><time data-format="HH:mm"><%= attendance.interval_start_at&.to_s(:rfc822) %></time><p>
        <p>
          <% if attendance.interval_finish_at %>
            <time data-format="HH:mm"><%= attendance.interval_finish_at.to_s(:rfc822) %></time>
          <% elsif attendance.interval_finish_at.blank? && attendance.interval_start_at.present? %>
            <%= link_to 'Re-Punch', new_admin_attendance_log_path(attendance_id: attendance.id), remote: true, class: 'ui teal mini button' %>
          <% end %>
        </p>
      </td>
      <td class="ui labels">
        <% if attendance.interval_absence_id %>
          <p><%= link_to attendance.interval_hours, admin_absence_path(attendance.interval_absence_id), remote: true, class: 'ui green label' %></p>
        <% elsif attendance.interval_hours.to_f > 0 %>
          <p><span class="ui label"><%= attendance.interval_hours %></span></p>
        <% end %>
      </td>
      <td class="ui labels">
        <% if attendance.late_absence_id %>
          <p>
            <%= link_to attendance.late_minutes.to_i.minutes.inspect, admin_absence_path(attendance.late_absence_id), remote: true, class: 'ui green label' %>
          </p>
        <% elsif attendance.late_minutes %>
          <p><span class="ui label"><%= attendance.late_minutes.to_i.minutes.inspect %></span></p>
        <% end %>
        <% if attendance.leave_absence_id %>
          <p>
            <%= link_to attendance.late_minutes.to_i.minutes.inspect, admin_absence_path(attendance.leave_absence_id), remote: true, class: 'ui green label' %>
          </p>
        <% elsif attendance.leave_minutes %>
          <p><span class="ui label"><%= attendance.leave_minutes.to_i.minutes.inspect %></span></p>
        <% end %>
      </td>
      <td>
        <p><%= attendance.attend_hours.to_d.to_s(:human) %>h</p>
        <p><%= attendance.overtime_hours.to_d.to_s(:human) %>h</p>
      </td>
      <td>
        <% if attendance.workday %>
          <i class="green check icon"></i>
        <% else %>
          <i class="red times icon"></i>
        <% end %>
      </td>
      <td><%= attendance.kind_i18n %></td>
      <td class="ui labels">
        <%= link_to 'logs', admin_attendance_logs_path(attendance_id: attendance.id), class: 'ui blue label' %>
        <%= link_to t('.edit'), edit_admin_attendance_path(attendance), class: 'ui pink label' %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>

<%= paginate @attendances %>
